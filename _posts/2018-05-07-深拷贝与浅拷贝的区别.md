---
layout: post
title: 深拷贝与浅拷贝的区别
date: 2018-05-07
categories: php
tags: [php]
description: 深拷贝与浅拷贝的区别
---

* content
{:toc}

### 深拷贝
赋值时完全复制，对其中一个变量做改变，不会影响另一个。如下示例，变量`a`赋值给`b`后，对`b`的值进行改动，不会影响到`a`。

```php
<?php
	$a = 1;
	$b = $a;
	$b = 2;
	echo $a;    #输出1
?>
```

### 浅拷贝
赋值时是引用赋值，只是换了一个名字，所指向的内容相同，一个改变，另一个也会做出同样的变动。

```php
<?php
    class Test{
        public $a=1;
    }
    $m = new Test();
    $n = $m;
    $m->a = 2;
    echo $n->a;
?>
```

在PHP中，对象的赋值永远都是引用赋值，也就是浅拷贝，无论参数是否加上了`&`符号都没有任何影响。那如何才能对对象进行深拷贝呢？可以通过`clone`函数实现。

### 克隆对象
```php
<?php
    class Test{
        public $a=1;
    }
    $m = new Test();
    $n = clone $m;
    $m->a = 2;
    echo $n->a;
?>
```
通过以上方式成功实现了对象复制，但是又有一个问题，对象的普通属性可以成功的值复制，但是对象属性还是引用赋值。如下：
```php
<?php
    class Test{
        public $a=1;
    }
    class TestOne{
        public $a=1;
        public $object;
        public function __construct()
        {
            $this->object = new Test();
        }
    }
    $m = new TestOne();
    $n = clone $m;
    $m->object->a = 2;
    echo $n->object->a; #输出2，变量n的对象属性被更改
?>
```
我们可以做个修改，通过重写`__clone`的方式进行对象属性的复制。
```php
<?php
    class Test{
        public $a=1;
    }
    class TestOne{
        public $a=1;
        public $object;
        public function __construct()
        {
            $this->object = new Test();
        }
        
        public function __clone()
        {
            $this->object = clone $this->object;
        }
    }
    $m = new TestOne();
    $n = clone $m;
    $m->object->a = 2;
    echo $n->object->a; #输出1，对象属性没有被更改
?>
```
成功完成对象属性的深拷贝。
